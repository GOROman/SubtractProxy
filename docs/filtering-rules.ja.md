# コンテンツフィルタリングルール

## 概要

SubtractProxyは、LLM（大規模言語モデル）技術を使用した強力なコンテンツフィルタリング機能を提供します。このドキュメントでは、フィルタリングシステムの設定方法と効果的な使用方法について説明します。

## 基本設定

### LLM設定

```json
{
  "llm": {
    "enabled": true,
    "type": "ollama",
    "model": "gemma",
    "baseUrl": "http://localhost:11434",
    "rules": {
      "categories": ["nsfw", "spam", "malware"],
      "sensitivity": "medium",
      "customPatterns": []
    }
  }
}
```

## フィルタリングカテゴリ

### 1. 組み込みカテゴリ

- **NSFW（不適切）コンテンツ**
  - アダルトコンテンツ
  - 露骨な表現
  - 年齢制限コンテンツ

- **スパム**
  - 迷惑広告
  - 大量メッセージ
  - プロモーション内容

- **マルウェア**
  - 不審なスクリプト
  - 既知の悪意のあるパターン
  - セキュリティ脅威

### 2. カスタムカテゴリ

パターンを追加してカスタムカテゴリを作成できます：

```json
{
  "llm": {
    "rules": {
      "customPatterns": [
        {
          "name": "company-confidential",
          "patterns": [
            "confidential",
            "internal-only",
            "proprietary"
          ],
          "action": "block"
        }
      ]
    }
  }
}
```

## フィルタリングアクション

### 1. ブロック
- エラーページを返す
- ブロックされたリクエストを記録
- ユーザーに通知

### 2. 許可
- コンテンツをそのまま通過
- オプションでログを記録
- 変更なし

### 3. 修正
- コンテンツを変換
- 特定の要素を削除
- 構造を保持

### 4. ログ
- ブロックせずに記録
- 詳細なログ
- 分析目的

## 高度な設定

### 1. 感度レベル

```json
{
  "llm": {
    "rules": {
      "sensitivity": "high",
      "thresholds": {
        "nsfw": 0.8,
        "spam": 0.7,
        "malware": 0.9
      }
    }
  }
}
```

### 2. URLパターン

```json
{
  "llm": {
    "rules": {
      "urlPatterns": {
        "whitelist": [
          "*.trusted-domain.com",
          "api.service.com/*"
        ],
        "blacklist": [
          "*.suspicious-site.com",
          "*/ads/*"
        ]
      }
    }
  }
}
```

## ベストプラクティス

1. **パフォーマンス最適化**
   - 初期フィルタリングにURLパターンを使用
   - 適切なしきい値を設定
   - 可能な場合はキャッシュを有効化

2. **セキュリティ**
   - ブロックリストを定期的に更新
   - 誤検知を監視
   - ログを定期的にレビュー

3. **メンテナンス**
   - LLMモデルを最新に保つ
   - カスタムパターンを改善
   - 感度レベルを調整

## トラブルシューティング

### よくある問題

1. **誤検知**
   - 感度レベルを調整
   - カスタムパターンを見直し
   - ホワイトリストを更新

2. **パフォーマンス**
   - LLMサーバーの状態を確認
   - パターンマッチングを最適化
   - キャッシュ設定を確認

3. **設定**
   - JSONの構文を検証
   - ルールの形式を確認
   - パターンの構文を確認
